version: "3.9"

services:
  xrps:
    build:
      context: ..
      dockerfile: Dockerfile.xrps
    image: xrp/xrps:local
    container_name: xrps
    restart: unless-stopped
    environment:
      # 可选：静态资源目录（若你用前端构建产物挂载到容器）
      # - XRPS_UI_DIR=/ui
      - XRPS_LOG_DIR=/logs
      - HOME=/home/app
      # 可选：自定义 Xray 资产目录（geo* 文件）
      # - XRAY_LOCATION_ASSET=/assets
      # 可选：使用外部调试配置替代内置生成
      # - XRAY_CFG_PORTAL=/home/app/xrp/xray.portal.json
    volumes:
      # 持久化 HOME：用于保存 ~/xrps/admin.auth.json 与 ~/xrp/xray.portal.json
      - xrps-data:/home/app
      # 可选：持久化日志
      - xrps-logs:/logs
      # 可选：挂载静态 UI 目录
      # - ./web/xrps/dist:/ui:ro
    ports:
      - "8080:8080"   # XRPS API/UI
      # 下面这些端口仅为示例，取决于你在 XRPS 中创建的隧道配置
      # - "9443:9443"   # REALITY handshake 端口（示例）
      # - "31234:31234" # Tunnel entry 端口（示例）
      # - "31235:31235" # Tunnel entry 端口（示例）

  xrpc:
    build:
      context: ..
      dockerfile: Dockerfile.xrpc
    image: xrp/xrpc:local
    container_name: xrpc
    restart: unless-stopped
    environment:
      - XRPC_LOG_DIR=/logs
      - HOME=/home/app
      # 可选：自定义 Xray 资产目录（geo* 文件）
      # - XRAY_LOCATION_ASSET=/assets
      # 可选：使用外部调试配置替代内置生成
      # - XRAY_CFG_BRIDGE=/home/app/xrp/xray.bridge.json
    volumes:
      # 持久化 HOME：用于保存 ~/xrpc/admin.auth.json 与 ~/xrp/xray.bridge.json
      - xrpc-data:/home/app
      - xrpc-logs:/logs
      # 可选：挂载静态 UI 目录
      # - ./web/xrpc/dist:/ui:ro
    ports:
      - "8081:8081"   # XRPC API/UI

volumes:
  xrps-data: {}
  xrpc-data: {}
  xrps-logs: {}
  xrpc-logs: {}

