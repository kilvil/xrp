version: "3.9"

services:
  xrps:
    build:
      context: ..
      dockerfile: Dockerfile.xrps
    image: xrp/xrps:local
    container_name: xrps
    restart: unless-stopped
    environment:
      - XRPS_LOG_DIR=/logs
      - XRPS_STATE_DIR=/home/app/xrps
      - HOME=/home/app
      # 可选：自定义 Xray 资产目录（geo* 文件）
      # - XRAY_LOCATION_ASSET=/assets
      # 可选：使用外部调试配置替代内置生成
      # - XRAY_CFG_PORTAL=/home/app/xrp/xray.portal.json
    volumes:
      # 持久化 XRPS 状态与配置：/home/app/xrps 与 ~/xrp/xray.portal.json
      - xrps-data:/home/app
      # 可选：持久化日志
      - xrps-logs:/logs
    ports:
      - "8080:8080"   # XRPS API
      # 下面这些端口仅为示例，取决于你在 XRPS 中创建的隧道配置
      # - "9443:9443"   # REALITY handshake 端口（示例）
      # - "31234:31234" # Tunnel entry 端口（示例）
      # - "31235:31235" # Tunnel entry 端口（示例）

  xrpc:
    build:
      context: ..
      dockerfile: Dockerfile.xrpc
    image: xrp/xrpc:local
    container_name: xrpc
    restart: unless-stopped
    environment:
      - XRPC_LOG_DIR=/logs
      - XRPC_STATE_DIR=/home/app/xrpc
      - HOME=/home/app
      # 可选：自定义 Xray 资产目录（geo* 文件）
      # - XRAY_LOCATION_ASSET=/assets
      # 可选：使用外部调试配置替代内置生成
      # - XRAY_CFG_BRIDGE=/home/app/xrp/xray.bridge.json
    volumes:
      # 持久化 XRPC 状态与配置：/home/app/xrpc 与 ~/xrp/xray.bridge.json
      - xrpc-data:/home/app
      - xrpc-logs:/logs
    ports:
      - "8081:8081"   # XRPC API

volumes:
  xrps-data: {}
  xrpc-data: {}
  xrps-logs: {}
  xrpc-logs: {}
